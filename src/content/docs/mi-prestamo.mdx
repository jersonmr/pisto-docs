---
title: Flujo de Mi PrÃ©stamo
slug: mi-prestamo
tags: [auth, flutter, riverpod, dio, formz, go_router, freezed, json_annotation]
description: Flujo de Mi PrÃ©stamo. GestiÃ³n completa del proceso de prÃ©stamo, desde la solicitud hasta la confirmaciÃ³n visual.
---

## DescripciÃ³n General

**Mi PrÃ©stamo** es el mÃ³dulo central de la aplicaciÃ³n Pisto que permite a los usuarios:

-   Solicitar nuevos prÃ©stamos mediante una calculadora interactiva
-   Visualizar el estado actual de sus prÃ©stamos activos
-   Gestionar el ciclo completo del prÃ©stamo (solicitud, aprobaciÃ³n, pago, cierre)
-   Consultar informaciÃ³n detallada de deudas y pagos
-   Aplicar cÃ³digos promocionales para obtener descuentos

Esta funcionalidad es accesible desde la ruta `/my-loan` y se encuentra disponible en el menÃº lateral de navegaciÃ³n principal.

---

## Para el Usuario Final

### Â¿QuÃ© puedo hacer en "Mi PrÃ©stamo"?

#### 1. **Solicitar un PrÃ©stamo (Sin prÃ©stamo activo)**

Cuando no tienes un prÃ©stamo activo, verÃ¡s una calculadora interactiva donde puedes:

-   **Seleccionar el monto**: Usa el deslizador para elegir cuÃ¡nto dinero necesitas (segÃºn tu nivel de cliente)
-   **Elegir el plazo**: Selecciona en cuÃ¡ntos dÃ­as podrÃ¡s pagarlo
-   **Ver el desglose completo**:
    -   ğŸ’° **Tu obtienes**: El dinero que recibirÃ¡s en tu cuenta
    -   ğŸ“ˆ **InterÃ©s**: El costo del prÃ©stamo
    -   ğŸ“„ **Gastos administrativos**: Comisiones de gestiÃ³n
    -   ğŸ§¾ **IVA**: Impuesto sobre el valor agregado
    -   ğŸ’µ **Monto a devolver**: Total que debes pagar
    -   ğŸ“… **Fecha de devoluciÃ³n**: CuÃ¡ndo vence el pago

**CÃ³digos Promocionales**: Puedes ingresar un cÃ³digo promocional para obtener descuentos en los costos del prÃ©stamo.

#### 2. **Estados de tu PrÃ©stamo**

Tu prÃ©stamo puede encontrarse en diferentes estados:

##### ğŸŸ¡ **PrÃ©stamo en ConsideraciÃ³n** (Estado 2)

-   Tu solicitud estÃ¡ siendo evaluada
-   Puedes ver los detalles del prÃ©stamo solicitado
-   Tienes la opciÃ³n de rechazar tu solicitud si cambias de opiniÃ³n

##### ğŸ”´ **Fotos No Adecuadas** (Estado 3)

-   Las fotos que cargaste no cumplen con los requisitos
-   Debes volver a cargar fotos nÃ­tidas y completas
-   Se te indicarÃ¡ quÃ© fotos especÃ­ficas necesitas actualizar

##### ğŸŸ¢ **PrÃ©stamo Aprobado** (Estado 4)

-   Â¡Felicidades! Tu prÃ©stamo fue aprobado
-   VerÃ¡s el desglose de pagos anticipados (si aplica)
-   Debes aceptar el prÃ©stamo para que el dinero sea transferido
-   SegÃºn tu perfil, podrÃ­as necesitar autenticaciÃ³n biomÃ©trica

##### âœ… **PrÃ©stamo Activo** (Estado 5)

-   Tu prÃ©stamo estÃ¡ vigente
-   Visualizas:
    -   NÃºmero de contrato
    -   Detalles del prÃ©stamo
    -   OpciÃ³n de pago anticipado con descuento
    -   Escala de pagos con fechas especÃ­ficas
-   Puedes **registrar pagos realizados** desde esta pantalla
-   Notificaciones especiales (si aplican)

##### âš ï¸ **PrÃ©stamo en Mora** (Estado 6)

-   Tu prÃ©stamo estÃ¡ vencido
-   VerÃ¡s un desglose completo de la deuda que incluye:
    -   Monto original del prÃ©stamo
    -   Deuda por refinanciamiento (si aplica)
    -   Intereses moratorios
    -   Gastos de cobranza
    -   Gastos de abogado
    -   Gastos de ejecutor de embargo
    -   Pagos recibidos
    -   Monto total pendiente
-   **Importante**: Si no pagas, arriesgas tu historial crediticio
-   Puedes registrar tus pagos realizados

##### ğŸ‰ **PrÃ©stamo Pagado Completamente** (Estado 7)

-   Has pagado la totalidad de tu prÃ©stamo
-   EstÃ¡ en proceso de cierre administrativo
-   Pronto podrÃ¡s solicitar un nuevo prÃ©stamo

#### 3. **Estados Especiales del Cliente**

##### ğŸŸ  **Cliente Suspendido** (Estado 7)

-   Tu cuenta estÃ¡ suspendida temporalmente por 14 dÃ­as
-   Se te indica la fecha de suspensiÃ³n
-   PodrÃ¡s solicitar un nuevo prÃ©stamo despuÃ©s del periodo de suspensiÃ³n

##### ğŸ”’ **Cliente Bloqueado** (Estado 8)

-   Tu cuenta ha sido bloqueada permanentemente
-   Se muestra la fecha de bloqueo
-   Si tienes deuda pendiente, aÃºn puedes registrar pagos
-   Para resolver tu caso, debes contactar a: **cliente@pisto.co**

### CaracterÃ­sticas Adicionales

#### ğŸ“± Pull to Refresh

Desliza hacia abajo en cualquier momento para actualizar la informaciÃ³n de tu prÃ©stamo.

#### ğŸŸï¸ CÃ³digos Promocionales

-   Ingresa cÃ³digos promocionales en la calculadora
-   ObtÃ©n descuentos en los gastos administrativos
-   Los descuentos se aplican automÃ¡ticamente al cÃ¡lculo

#### ğŸ’³ Pago Anticipado

-   Si pagas antes de la fecha de vencimiento, obtienes descuentos
-   La aplicaciÃ³n te muestra cuÃ¡nto ahorrarÃ¡s
-   Escala de pagos con descuentos progresivos por fecha

---

## Para el Desarrollador

### Arquitectura del MÃ³dulo

```
lib/features/my_loan/
â”œâ”€â”€ entities/              # Modelos de dominio (entidades de negocio)
â”‚   â”œâ”€â”€ calculator_entity.dart
â”‚   â”œâ”€â”€ loan_entity.dart
â”‚   â”œâ”€â”€ promo_code_entity.dart
â”‚   â””â”€â”€ concept_amount_entity.dart
â”œâ”€â”€ models/               # DTOs y mappers (capa de datos)
â”‚   â”œâ”€â”€ calculator_dto.dart
â”‚   â”œâ”€â”€ my_loan_response_dto.dart
â”‚   â”œâ”€â”€ promo_code_request_dto.dart
â”‚   â””â”€â”€ mappers.dart
â”œâ”€â”€ providers/            # GestiÃ³n de estado (Riverpod)
â”‚   â”œâ”€â”€ my_loan_provider.dart
â”‚   â”œâ”€â”€ loan_calculator_provider.dart
â”‚   â”œâ”€â”€ promo_code_provider.dart
â”‚   â””â”€â”€ loan_status_provider.dart
â”œâ”€â”€ repositories/         # Capa de acceso a datos
â”‚   â”œâ”€â”€ my_loan_repository.dart
â”‚   â””â”€â”€ promo_code_repository.dart
â”œâ”€â”€ enums/               # Enumeraciones
â”‚   â”œâ”€â”€ loan_status_enum.dart
â”‚   â”œâ”€â”€ client_status_enum.dart
â”‚   â””â”€â”€ loan_constants_enum.dart
â”œâ”€â”€ screens/             # Pantallas
â”‚   â””â”€â”€ my_loan_screen.dart
â””â”€â”€ widgets/             # Componentes UI
    â”œâ”€â”€ loan_calculator_widget.dart
    â”œâ”€â”€ active_loan_widget.dart
    â”œâ”€â”€ loan_status_2_widget.dart
    â”œâ”€â”€ loan_status_3_widget.dart
    â”œâ”€â”€ loan_status_4_widget.dart
    â”œâ”€â”€ loan_status_5_widget.dart
    â”œâ”€â”€ loan_status_6_widget.dart
    â”œâ”€â”€ loan_status_7_widget.dart
    â”œâ”€â”€ loan_details_section.dart
    â”œâ”€â”€ loan_in_arrears_details_widget.dart
    â”œâ”€â”€ blocked_client_widget.dart
    â”œâ”€â”€ suspended_client_widget.dart
    â””â”€â”€ promo_code_widget.dart
```

---

## Flujos de Trabajo

### 1. InicializaciÃ³n de la Pantalla

```dart
MyLoanScreen (initState)
    â†“
_performGlobalReset()
    â†“
1. authProvider.getUser() // Refrescar datos del usuario
    â†“
2. acceptLoanProvider.reset() // Limpiar estado de accept_loan
    â†“
3. myLoanProvider.loadLoanData() // Cargar datos del prÃ©stamo
    â†“
Render UI segÃºn estado
```

**PropÃ³sito del Reset Global**:

-   Asegurar que los datos del usuario estÃ©n actualizados
-   Limpiar estados anteriores de flujos de aceptaciÃ³n de prÃ©stamos
-   Evitar inconsistencias entre mÃ³dulos
-   Proporcionar datos frescos al usuario

### 2. Carga de Datos del PrÃ©stamo

```dart
loadLoanData()
    â†“
myLoanRepository.getMyLoanData()
    â†“
GET /mobile/client/my-loan
    â†“
MyLoanResponseDto.fromJson()
    â†“
toEntity() // Mapper DTO â†’ Entity
    â†“
Update State (MyLoanState)
    â†“
_initializeCalculatorIfNeeded() // Si loanStatus = 1
```

### 3. Flujo de la Calculadora de PrÃ©stamo

```dart
Usuario selecciona monto
    â†“
loanCalculatorProvider.updateSelectedAmount(amount)
    â†“
- Obtener dÃ­as disponibles para el monto
- Filtrar dÃ­as segÃºn clientStatus
- Establecer dÃ­a inicial vÃ¡lido
    â†“
_calculateLoanValues(calculator)
    â†“
- Calcular interÃ©s (interest + pistoInterest)
- Calcular gastos administrativos (concepts)
- Aplicar descuento de promo code (si existe)
- Calcular IVA
- Calcular "Tu obtienes" (monto - gastos totales)
- Calcular "Monto a devolver"
- Calcular fecha de devoluciÃ³n
    â†“
Update State con resultados
    â†“
UI se actualiza automÃ¡ticamente (watch)
```

### 4. AplicaciÃ³n de CÃ³digo Promocional

```dart
Usuario ingresa cÃ³digo
    â†“
promoCodeFormProvider.onPromoCodeChange(code)
    â†“
Validar formato (PromoCodeInput)
    â†“
Usuario presiona "Aplicar"
    â†“
promoCodeFormProvider.validatePromoCode()
    â†“
POST /mobile/promo-code/validation
    â†“
Respuesta del servidor:
  â”œâ”€â”€ success: loanCalculatorProvider.applyPromoCode(promoCode)
  â”œâ”€â”€ alreadyUsed: mostrar error
  â”œâ”€â”€ ownCode: mostrar error
  â”œâ”€â”€ invalid: mostrar error
  â””â”€â”€ error: mostrar error
    â†“
Recalcular prÃ©stamo con descuento aplicado
```

### 5. NavegaciÃ³n segÃºn Estado del PrÃ©stamo

```dart
_LoanStateHandler.buildContent(ref)
    â†“
Verificar isLoading â†’ LoadingWidget
    â†“
Verificar error â†’ ErrorStateWidget
    â†“
Verificar loanData == null â†’ NoLoanWidget
    â†“
Verificar clientStatus:
  â”œâ”€â”€ 7 (suspended) â†’ SuspendedClientWidget
  â””â”€â”€ 8 (blocked) â†’ BlockedClientWidget
    â†“
Verificar loanStatus:
  â”œâ”€â”€ 1 â†’ LoanCalculatorWidget
  â”œâ”€â”€ 2 â†’ LoanStatus2Widget (en consideraciÃ³n)
  â”œâ”€â”€ 3 â†’ LoanStatus3Widget (fotos rechazadas)
  â”œâ”€â”€ 4 â†’ LoanStatus4Widget (aprobado)
  â”œâ”€â”€ 5 â†’ LoanStatus5Widget (activo)
  â”œâ”€â”€ 6 â†’ LoanStatus6Widget (en mora)
  â””â”€â”€ 7 â†’ LoanStatus7Widget (pagado)
```

---

## Estados del Sistema

### Estados del Cliente (userStatus)

```dart
enum ClientStatus {
  status2(2),    // Primer nivel de cliente
  status3(3),    // Segundo nivel
  status4(4),    // Tercer nivel
  status5(5),    // Cuarto nivel
  status6(6),    // Quinto nivel
  suspended(7),  // Suspendido 14 dÃ­as
  blocked(8),    // Bloqueado permanentemente
  status9(9),    // Nuevo nivel (Mayo 2025)
  status10(10),  // Nuevo nivel (Mayo 2025)
  vip(11);       // VIP con lÃ­mite personalizado (Mayo 2025)
}
```

**Importancia**: El `userStatus` determina:

-   LÃ­mites de prÃ©stamo disponibles
-   DÃ­as de prÃ©stamo permitidos
-   Acceso a la plataforma (suspendido/bloqueado)

### Estados del PrÃ©stamo (loanStatus)

```dart
enum LoanStatus {
  withoutActiveLoan(1),      // Sin prÃ©stamo activo â†’ Calculadora
  loanInConsideration(2),    // En evaluaciÃ³n
  photosRejected(3),         // Fotos no adecuadas
  loanApproved(4),           // Aprobado (pendiente aceptaciÃ³n)
  loanAccepted(5),           // Activo
  loanOverdue(6),            // En mora
  loanPaidInFull(7);         // Pagado completamente
}
```

### Entidad Principal: LoanEntity

```dart
class LoanEntity {
  // Estados
  int userStatus;           // 2-11 (estado del cliente)
  int? loanStatus;          // 1-7 (estado del prÃ©stamo)
  int? loanId;              // ID del prÃ©stamo activo

  // Calculadora (solo loanStatus = 1)
  CalculatorEntity? calculator;

  // InformaciÃ³n bÃ¡sica del prÃ©stamo
  String? contractNumber;
  String? loanAmount;
  int? loanDays;
  double? interestAmount;
  double? administrativeAmount;
  List<ConceptAmountEntity>? conceptsAmount;
  double? ivaAmount;
  double? totalRefundAmount;
  double? restAmount;
  DateTime? loanDate;
  DateTime? loanReturnDate;

  // Pago anticipado
  bool showReturnNow;
  double? amountReturnNow;
  double? amountSavedReturnNow;
  List<ReturnScaleEntity>? returnScale;

  // Estados especiales del cliente
  DateTime? suspendedDate;          // status = 7
  int? remainingSuspendedDays;      // status = 7
  DateTime? lockDate;               // status = 8

  // Notificaciones
  String? specialNotification;
  String? refinancingNotification;

  // InformaciÃ³n de mora (Estado 6)
  double? moratoryLoanAmount;
  double? originalDebtAmount;
  double? refinancingDebtAmount;
  double? moratoryInterest;
  double? collectionAmount;
  double? lawyerAmount;
  double? embargoExecutorAmount;
  double? paymentsReceived;
}
```

---

## Componentes Principales

### 1. MyLoanScreen

**Responsabilidad**: Pantalla principal del mÃ³dulo.

**CaracterÃ­sticas**:

-   Lifecycle management (reset global en initState)
-   RefreshIndicator para actualizaciÃ³n manual
-   DelegaciÃ³n a widgets especÃ­ficos segÃºn estado
-   GestiÃ³n del nÃºmero de contrato

```dart
class MyLoanScreen extends ConsumerStatefulWidget {
  static const String route = '/my-loan';

  // Features:
  // - Global reset on initialization
  // - Pull to refresh
  // - State-based widget rendering
}
```

### 2. LoanCalculatorWidget

**Responsabilidad**: Interfaz de solicitud de prÃ©stamos.

**CaracterÃ­sticas**:

-   Sliders interactivos (Syncfusion)
-   CÃ¡lculo en tiempo real
-   IntegraciÃ³n con cÃ³digos promocionales
-   ValidaciÃ³n de montos y dÃ­as segÃºn clientStatus
-   NavegaciÃ³n a flujos de primer/subsecuente prÃ©stamo

```dart
class LoanCalculatorWidget extends ConsumerStatefulWidget {
  // Features:
  // - Amount slider with dynamic steps
  // - Days slider filtered by client status
  // - Real-time calculation display
  // - Promo code integration
  // - "ObtÃ©n el Dinero" button
}
```

### 3. ActiveLoanWidget

**Responsabilidad**: Factory pattern para renderizar widgets segÃºn loanStatus.

```dart
class _ActiveLoanFactory {
  static Widget createWidget(int loanStatus, LoanEntity loanData) {
    switch (loanStatus) {
      case 2: return LoanStatus2Widget();
      case 3: return LoanStatus3Widget();
      case 4: return LoanStatus4Widget();
      case 5: return LoanStatus5Widget();
      case 6: return LoanStatus6Widget();
      case 7: return LoanStatus7Widget();
      default: return NoLoanWidget();
    }
  }
}
```

### 4. Widgets de Estado EspecÃ­fico

#### LoanStatus2Widget (En ConsideraciÃ³n)

-   Indicador de estado
-   Detalles del prÃ©stamo solicitado
-   BotÃ³n "Rechazar solicitud"

#### LoanStatus3Widget (Fotos Rechazadas)

-   Indicador de estado
-   Lista de fotos que deben recargarse
-   BotÃ³n para recargar fotos

#### LoanStatus4Widget (Aprobado)

-   Indicador de estado
-   Escala de pagos anticipados
-   Detalles del prÃ©stamo
-   BotÃ³n "Aceptar PrÃ©stamo"
-   RedirecciÃ³n a autenticaciÃ³n biomÃ©trica (si aplica)

#### LoanStatus5Widget (Activo)

-   Indicador de estado
-   InformaciÃ³n de pago anticipado
-   Escala de descuentos por fecha
-   Detalles del prÃ©stamo
-   BotÃ³n "Registrar pago realizado"
-   Notificaciones especiales

#### LoanStatus6Widget (En Mora)

-   Indicador de estado crÃ­tico
-   Detalles de la deuda (LoanInArrearsDetailsWidget)
-   BotÃ³n "Registrar pago realizado"
-   Advertencia legal

#### LoanStatus7Widget (Pagado)

-   Indicador de Ã©xito
-   Mensaje de confirmaciÃ³n
-   InformaciÃ³n de cierre del prÃ©stamo

### 5. Widgets de Cliente Especial

#### SuspendedClientWidget

-   Mensaje de suspensiÃ³n temporal
-   Fecha de suspensiÃ³n
-   DÃ­as restantes para solicitar nuevo prÃ©stamo

#### BlockedClientWidget

-   Mensaje de bloqueo permanente
-   Fecha de bloqueo
-   Contacto de soporte
-   Si tiene deuda: detalles + botÃ³n de pago

---

## GestiÃ³n de Estado

### 1. MyLoanProvider (Estado Principal)

```dart
@freezed
class MyLoanState {
  bool isLoading;
  LoanEntity? loanData;
  String? error;

  // Estado de calculadora (loanStatus = 1)
  int? selectedAmount;
  int? selectedDays;
  LoanCalculationResult? calculationResult;

  // Estados de acciones
  bool isRejecting;
  bool isAccepting;
  bool isUploadingPhotos;
  bool isClosing;
}
```

**MÃ©todos principales**:

-   `loadLoanData()`: Cargar datos desde API
-   `_initializeCalculatorIfNeeded()`: Inicializar calculadora si loanStatus = 1

**Provider derivados**:

```dart
@riverpod
int? currentLoanStatus(Ref ref) {
  return ref.watch(myLoanProvider.select((state) => state.loanData?.loanStatus));
}

@riverpod
int? currentClientStatus(Ref ref) {
  return ref.watch(myLoanProvider.select((state) => state.loanData?.userStatus));
}
```

### 2. LoanCalculatorProvider (Calculadora)

```dart
@freezed
class LoanCalculatorState {
  int selectedAmount;
  int selectedDays;
  double interestAmount;
  double administrativeAmount;
  double ivaAmount;
  double totalRefundAmount;
  double youReceive;
  bool isCalculating;
  List<int>? amounts;
  List<int>? days;
  List<ConceptAmountEntity> conceptsBreakdown;
  String? error;
  PromoCodeEntity? appliedPromoCode;
  double promoCodeDiscount;
  bool hasPromoCode;
}
```

**MÃ©todos principales**:

-   `initializeCalculator()`: Inicializar con datos del servidor
-   `updateSelectedAmount()`: Cambiar monto seleccionado
-   `updateSelectedDays()`: Cambiar dÃ­as seleccionados
-   `_calculateLoanValues()`: Calcular todos los valores del prÃ©stamo
-   `applyPromoCode()`: Aplicar descuento por cÃ³digo promocional
-   `_getAvailableDays()`: Filtrar dÃ­as segÃºn clientStatus

**LÃ³gica de dÃ­as permitidos por clientStatus**:

```dart
List<int> _getAvailableDays(int clientStatus) {
  switch (clientStatus) {
    case 2:
    case 3:
      return [34]; // Solo 34 dÃ­as
    case 4:
    case 5:
    case 6:
      return [34, 62]; // 34 o 62 dÃ­as
    default:
      return [34, 62, 90]; // Todos los plazos
  }
}
```

### 3. PromoCodeFormProvider

```dart
@freezed
class PromoCodeFormState {
  PromoCodeInput promoCode;
  FormzSubmissionStatus status;
  bool isValid;
  String? errorMessage;
  bool isLoading;
  bool isApplied;
}
```

**MÃ©todos principales**:

-   `onPromoCodeChange()`: Actualizar input
-   `validatePromoCode()`: Validar con API
-   `reset()`: Limpiar estado

---

## API y Repositorios

### MyLoanRepository

**Endpoint**: `GET /mobile/client/my-loan`

**Respuesta**: `MyLoanResponseDto`

**Manejo de errores**:

```dart
try {
  final response = await _httpClient.get('/mobile/client/my-loan');
  return MyLoanResponseDto.fromJson(response.data);
} on DioException catch (e) {
  if (statusCode == 403) {
    throw MyLoanException(type: MyLoanExceptionType.unauthorized);
  }
  throw MyLoanException(type: MyLoanExceptionType.network);
} catch (e) {
  throw MyLoanException(type: MyLoanExceptionType.unknown);
}
```

### PromoCodeRepository

**Endpoint**: `POST /mobile/promo-code/validation`

**Request**: `PromoCodeRequestDto`

```dart
{
  "promoCode": "DESCUENTO10"
}
```

**Response**: `PromoCodeResponseDto`

```dart
sealed class PromoCodeResult {
  success(PromoCodeEntity promoCode);
  alreadyUsed(String message);
  ownCode(String message);
  invalid(String message);
  error(String message);
  unauthenticated(String message);
}
```

---

## Consideraciones TÃ©cnicas

### 1. Keep Alive Providers

```dart
@Riverpod(keepAlive: true)
class MyLoanNotifier extends _$MyLoanNotifier { }

@Riverpod(keepAlive: true)
class LoanCalculatorNotifier extends _$LoanCalculatorNotifier { }
```

**RazÃ³n**: Mantener el estado del prÃ©stamo en memoria durante toda la sesiÃ³n de la aplicaciÃ³n.

### 2. Reset Global en MyLoanScreen

**Problema que resuelve**: Evitar inconsistencias entre mÃ³dulos cuando el usuario regresa de flujos de aceptaciÃ³n o solicitud de prÃ©stamos.

**ImplementaciÃ³n**:

```dart
Future<void> _performGlobalReset() async {
  await ref.read(authProvider.notifier).getUser();
  ref.read(acceptLoanProvider.notifier).reset();
  await ref.read(myLoanProvider.notifier).loadLoanData();
}
```

### 3. ValidaciÃ³n de DÃ­as segÃºn ClientStatus

Los dÃ­as disponibles para prÃ©stamos estÃ¡n filtrados segÃºn el nivel del cliente:

-   **Status 2-3**: Solo 34 dÃ­as
-   **Status 4-6**: 34 o 62 dÃ­as
-   **Status 7+**: 34, 62 o 90 dÃ­as

### 4. CÃ¡lculo de Montos

```dart
// FÃ³rmulas de cÃ¡lculo
administrativeAmount = concepts.reduce((a, b) => a + b.amount)
administrativeAmountWithDiscount = administrativeAmount * (1 - promoCodeDiscount)
ivaAmount = (interestAmount + administrativeAmountWithDiscount) * (iva / 100)
totalRefundAmount = loanAmount + interestAmount + administrativeAmountWithDiscount + ivaAmount
youReceive = loanAmount - administrativeAmountWithDiscount - ivaAmount
```

### 5. Mappers DTO â†’ Entity

Los mappers convierten datos de API (DTOs) a entidades de dominio:

```dart
extension MyLoanResponseDtoX on MyLoanResponseDto {
  LoanEntity toEntity() {
    return LoanEntity(
      userStatus: userStatus,
      loanStatus: loanStatus,
      // ... mÃ¡s campos
    );
  }
}
```

---

## Dependencias Clave

-   **flutter_riverpod**: GestiÃ³n de estado
-   **freezed**: GeneraciÃ³n de modelos inmutables
-   **formz**: ValidaciÃ³n de formularios
-   **go_router**: NavegaciÃ³n
-   **dio**: HTTP client
-   **syncfusion_flutter_sliders**: Sliders interactivos
-   **intl**: Formateo de fechas
