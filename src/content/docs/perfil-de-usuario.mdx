---
title: Flujo de perfil de usuario
slug: perfil-de-usuario
tags: [auth, flutter, riverpod, dio, formz, go_router, freezed, json_annotation]
description: Flujo de perfil de usuario. Gesti√≥n completa del proceso de actualizaci√≥n y verificaci√≥n de la informaci√≥n del perfil.
---

## Descripci√≥n General

La funcionalidad de **Perfil de Usuario** (`client_profile`) es el m√≥dulo central que permite a los usuarios gestionar y mantener actualizada su informaci√≥n personal en la plataforma Pisto. Este sistema proporciona una interfaz segura e intuitiva para modificar datos cr√≠ticos como n√∫mero de tel√©fono, contrase√±a y direcci√≥n, garantizando la integridad de los datos mediante validaciones robustas, verificaci√≥n por SMS y actualizaci√≥n autom√°tica del estado de autenticaci√≥n.

### üìä Estructura del Flujo

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Perfil Principal ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Selecci√≥n de     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Formulario de    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Validaci√≥n       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Confirmaci√≥n     ‚îÇ
‚îÇ ( Vista General )‚îÇ     ‚îÇ Actualizaci√≥n    ‚îÇ     ‚îÇ Cambio           ‚îÇ     ‚îÇ (API/SMS)        ‚îÇ     ‚îÇ (Resultado)      ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ (Tel√©fono/Pass)  ‚îÇ     ‚îÇ                     ‚îÇ     ‚îÇ                     ‚îÇ     ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚úì Datos actuales      ‚úì Opciones           ‚úì Validaci√≥n          ‚úì Verificaci√≥n        ‚úì √âxito/Error
```

### ‚ú® Caracter√≠sticas Principales

-   ‚úÖ **Gesti√≥n centralizada**: √önico punto para actualizar datos personales
-   ‚úÖ **Validaci√≥n en tiempo real**: Verificaci√≥n instant√°nea de cambios
-   ‚úÖ **Verificaci√≥n por SMS**: Seguridad adicional para cambios cr√≠ticos
-   ‚úÖ **Actualizaci√≥n autom√°tica**: Sincronizaci√≥n con estado de autenticaci√≥n
-   ‚úÖ **Historial de cambios**: Registro completo de modificaciones
-   ‚úÖ **Interfaz intuitiva**: Formularios claros con validaci√≥n visual
-   ‚úÖ **Manejo robusto de errores**: Recuperaci√≥n ante fallos
-   ‚úÖ **Seguridad financiera**: Cumplimiento con est√°ndares de datos personales

---

## Gu√≠a del Usuario

### üéØ ¬øPara qu√© sirve el perfil de usuario?

El perfil te permite:

-   **Actualizar tu tel√©fono**: Mantener tu n√∫mero de contacto actual
-   **Cambiar tu contrase√±a**: Mejorar la seguridad de tu cuenta
-   **Modificar tu direcci√≥n**: Actualizar tu domicilio para env√≠os y comunicaciones
-   **Ver tus datos**: Consultar toda tu informaci√≥n registrada
-   **Mantener seguridad**: Controlar qui√©n puede acceder a tu cuenta

### üì± C√≥mo gestionar tu perfil

#### Paso 1: Acceder a tu perfil

Para ver y editar tu informaci√≥n:

**Desde el men√∫ principal:**

1. üè† **Abre el men√∫ lateral** - Toca el √≠cono de hamburguesa (‚ò∞)
2. üë§ **Busca "Configuraci√≥n de perfil"** - Encuentra la opci√≥n en el men√∫
3. üëÜ **Presiona la opci√≥n** - Acceder√°s a tu perfil completo
4. üìä **Revisa tus datos** - Ver√°s toda tu informaci√≥n actual

**Informaci√≥n disponible:**

-   üìû **Datos de contacto** - Tel√©fono y email
-   üë§ **Datos personales** - Nombre, DUI, fecha de nacimiento
-   üè† **Direcci√≥n** - Domicilio completo
-   üìã **Informaci√≥n adicional** - Datos de registro y actividad

#### Paso 2: Actualizar tu n√∫mero de tel√©fono

Para cambiar tu n√∫mero de contacto:

**Proceso de cambio:**

1. üìû **Toca "Tel√©fono"** - En la secci√≥n de datos de contacto
2. üì± **Ingresa nuevo n√∫mero** - Escribe el nuevo n√∫mero telef√≥nico
3. ‚úÖ **Validaci√≥n autom√°tica** - El sistema verifica el formato
4. üì≤ **Recibir√°s SMS** - C√≥digo de verificaci√≥n en tu nuevo n√∫mero
5. üî¢ **Ingresa el c√≥digo** - Confirma que eres el due√±o del n√∫mero
6. ‚úÖ **Confirmaci√≥n** - Tu tel√©fono ser√° actualizado

**Caracter√≠sticas de seguridad:**

-   üîí **Verificaci√≥n obligatoria** - Siempre se requiere SMS
-   ‚è∞ **C√≥digo temporal** - El SMS expira en 5 minutos
-   üö´ **Un intento activo** - No puedes iniciar m√∫ltiples cambios
-   üìä **Historial registrado** - Se guarda el cambio anterior

#### Paso 3: Cambiar tu contrase√±a

Para mejorar la seguridad de tu cuenta:

**Proceso seguro:**

1. üîê **Toca "Contrase√±a"** - En la secci√≥n de seguridad
2. üîë **Ingresa contrase√±a actual** - Confirma tu identidad
3. üÜï **Escribe nueva contrase√±a** - Crea una contrase√±a segura
4. ‚úÖ **Confirma nueva contrase√±a** - Repite para evitar errores
5. üìä **Validaci√≥n de fortaleza** - El sistema indica si es segura
6. ‚úÖ **Aplicaci√≥n inmediata** - Tu contrase√±a se actualiza al instante

**Requisitos de contrase√±a:**

-   üî§ **M√≠nimo 8 caracteres** - Para mayor seguridad
-   üî¢ **Incluir n√∫meros** - Caracteres num√©ricos obligatorios
-   üî† **Letras may√∫sculas** - Al menos una may√∫scula
-   üö´ **No repetir anterior** - Debe ser diferente a la actual

#### Paso 4: Actualizar tu direcci√≥n

Para modificar tu domicilio:

**Proceso de actualizaci√≥n:**

1. üè† **Toca "Direcci√≥n"** - En la secci√≥n de ubicaci√≥n
2. üåç **Selecciona departamento** - Elige tu departamento
3. üèôÔ∏è **Elige municipio** - Selecciona tu municipio
4. üìç **Selecciona distrito** - Encuentra tu distrito espec√≠fico
5. üèòÔ∏è **Ingresa detalles** - Calle, n√∫mero y colonia/barrio
6. ‚úÖ **Confirmaci√≥n** - Tu direcci√≥n se actualiza inmediatamente

**Validaci√≥n de direcci√≥n:**

-   üó∫Ô∏è **Datos geogr√°ficos v√°lidos** - Solo ubicaciones existentes
-   üìù **Campos obligatorios** - Todos los datos requeridos
-   üè∑Ô∏è **Formato estandarizado** - Direcciones consistentes
-   üìä **Actualizaci√≥n autom√°tica** - Se refleja en todo el sistema

#### Paso 5: Confirmaci√≥n de cambios

Una vez realizados los cambios:

**Confirmaci√≥n visual:**

-   ‚úÖ **Mensaje de √©xito** - Confirmaci√≥n clara del cambio
-   üìä **Resumen de modificaci√≥n** - Qu√© se cambi√≥ y cu√°ndo
-   üîÑ **Actualizaci√≥n autom√°tica** - Los datos se sincronizan
-   üì± **Notificaci√≥n (opcional)** - Recordatorio del cambio

**Para cambios cr√≠ticos:**

-   üìß **Email de confirmaci√≥n** - Para cambios de tel√©fono
-   üîê **Actualizaci√≥n de sesi√≥n** - Para cambios de contrase√±a
-   üè† **Validaci√≥n de direcci√≥n** - Para cambios de domicilio

### ‚ö†Ô∏è Informaci√≥n importante

**Consideraciones de seguridad:**

-   üîí **Verificaci√≥n obligatoria** - Algunos cambios requieren SMS
-   üìä **Historial completo** - Todos los cambios quedan registrados
-   üö´ **Limitaciones de intentos** - Prevenci√≥n de abusos
-   üîê **Autenticaci√≥n requerida** - Solo usuarios autenticados

**Tiempo de actualizaci√≥n:**

-   ‚ö° **Contrase√±a**: Inmediato
-   üì± **Tel√©fono**: Despu√©s de verificaci√≥n SMS (5-10 minutos)
-   üè† **Direcci√≥n**: Inmediato
-   üìä **Sincronizaci√≥n**: Puede tomar hasta 1 hora en todos los sistemas

---

## Arquitectura T√©cnica

### üèóÔ∏è Estructura del M√≥dulo

El m√≥dulo de perfil de usuario sigue una arquitectura modular con separaci√≥n clara de responsabilidades:

```
client_profile/
‚îú‚îÄ‚îÄ entities/                    # Entidades de dominio
‚îÇ   ‚îú‚îÄ‚îÄ address_entity.dart               # Direcci√≥n del usuario
‚îÇ   ‚îú‚îÄ‚îÄ profile_update_type.dart          # Tipos de actualizaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ entities.dart                     # Export de entidades
‚îú‚îÄ‚îÄ models/                      # DTOs para API
‚îÇ   ‚îú‚îÄ‚îÄ update_address_request_dto.dart   # Request de direcci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ update_password_request_dto.dart  # Request de contrase√±a
‚îÇ   ‚îú‚îÄ‚îÄ update_phone_request_dto.dart     # Request de tel√©fono
‚îÇ   ‚îî‚îÄ‚îÄ models.dart                        # Export de modelos
‚îú‚îÄ‚îÄ providers/                   # Gesti√≥n de estado
‚îÇ   ‚îú‚îÄ‚îÄ change_address_provider.dart       # Estado de direcci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ change_password_provider.dart      # Estado de contrase√±a
‚îÇ   ‚îî‚îÄ‚îÄ change_phone_provider.dart         # Estado de tel√©fono
‚îú‚îÄ‚îÄ repositories/               # Acceso a datos
‚îÇ   ‚îî‚îÄ‚îÄ client_profile_repository.dart     # API de perfil
‚îî‚îÄ‚îÄ screens/                    # Interfaces de usuario
    ‚îú‚îÄ‚îÄ client_profile_screen.dart         # Pantalla principal
    ‚îú‚îÄ‚îÄ change_address_screen.dart         # Formulario direcci√≥n
    ‚îú‚îÄ‚îÄ change_password_screen.dart        # Formulario contrase√±a
    ‚îú‚îÄ‚îÄ change_phone_number_screen.dart    # Formulario tel√©fono
    ‚îú‚îÄ‚îÄ verify_sms_screen.dart             # Verificaci√≥n SMS
    ‚îî‚îÄ‚îÄ client_profile_result_screen.dart  # Resultado de cambios
```

### üìä Entities (Entidades de Dominio)

#### **AddressEntity**

Entidad que representa la direcci√≥n completa del usuario:

```dart
@freezed
class AddressEntity with _$AddressEntity {
  const factory AddressEntity({
    required String street,                 // Calle o avenida
    required String streetNumber,           // N√∫mero de domicilio
    required String municipality,           // Municipio
    required String suburb,                 // Colonia o barrio
    required String department,             // Departamento
    required String district,               // Distrito
  }) = _AddressEntity;
}
```

#### **ProfileUpdateType**

Enum que define los tipos de actualizaci√≥n posibles:

```dart
enum ProfileUpdateType {
  phone,     // Cambio de n√∫mero telef√≥nico
  password,  // Cambio de contrase√±a
  address;   // Cambio de direcci√≥n

  String get displayName => switch (this) {
    phone => 'Tel√©fono',
    password => 'Contrase√±a',
    address => 'Direcci√≥n',
  };

  String get successTitle => switch (this) {
    phone => '¬°Tel√©fono actualizado!',
    password => '¬°Contrase√±a actualizada!',
    address => '¬°Direcci√≥n actualizada!',
  };

  bool get requiresAuthUpdate => switch (this) {
    phone => true,    // Requiere actualizar auth provider
    password => false,
    address => true,
  };
}
```

### üéØ Providers (Gesti√≥n de Estado)

#### **ChangeAddressNotifier**

StateNotifier para gesti√≥n de direcci√≥n:

```dart
@riverpod
class ChangeAddressNotifier extends _$ChangeAddressNotifier {
  @override
  ChangeAddressState build() {
    // Inicializaci√≥n con datos del usuario
    return const ChangeAddressState();
  }

  // M√©todos principales:
  // - Future<void> initializeWithUserData()
  // - void onDepartmentChanged(DepartmentEntity?)
  // - void onDistrictChanged(DistrictEntity?)
  // - void onMunicipalityChanged(MunicipalityEntity?)
  // - void onStreetChanged(String)
  // - void onStreetNumberChanged(String)
  // - void onSuburbChanged(String)
  // - Future<void> submitAddress()
}

@freezed
class ChangeAddressState with _$ChangeAddressState {
  const factory ChangeAddressState({
    @Default(false) bool isLoading,
    @Default(false) bool isValid,
    @Default(false) bool hasChanges,
    @Default(TextInput.pure()) TextInput street,
    @Default(TextInput.pure()) TextInput streetNumber,
    @Default(TextInput.pure()) TextInput suburb,
    DepartmentEntity? selectedDepartment,
    DistrictEntity? selectedDistrict,
    MunicipalityEntity? selectedMunicipality,
    String? errorMessage,
    String? successMessage,
  }) = _ChangeAddressState;

  const ChangeAddressState._();
  bool get canSubmit => isValid && hasChanges && !isLoading;
}
```

#### **ChangePasswordNotifier**

StateNotifier para gesti√≥n de contrase√±a:

```dart
@Riverpod(keepAlive: true)
class ChangePasswordNotifier extends _$ChangePasswordNotifier {
  @override
  ChangePasswordState build() {
    return const ChangePasswordState();
  }

  // M√©todos principales:
  // - void onChangeCurrentPassword(String)
  // - void onChangeNewPassword(String)
  // - void onChangeConfirmPassword(String)
  // - void togglePasswordVisibility()
  // - Future<void> submitPassword()
}

@freezed
class ChangePasswordState with _$ChangePasswordState {
  const factory ChangePasswordState({
    @Default(false) bool isLoading,
    @Default(false) bool isValid,
    @Default(PasswordInput.pure()) PasswordInput currentPassword,
    @Default(PasswordInput.pure()) PasswordInput newPassword,
    @Default(PasswordConfirmationInput.pure()) PasswordConfirmationInput confirmPassword,
    @Default(false) bool currentPasswordVisible,
    @Default(false) bool newPasswordVisible,
    @Default(false) bool confirmPasswordVisible,
    String? errorMessage,
    String? successMessage,
  }) = _ChangePasswordState;

  const ChangePasswordState._();
  bool get canSubmit => isValid && !isLoading;
}
```

#### **ChangePhoneNotifier**

StateNotifier para gesti√≥n de tel√©fono con verificaci√≥n SMS:

```dart
@riverpod
class ChangePhoneNotifier extends _$ChangePhoneNotifier {
  @override
  ChangePhoneState build() {
    return const ChangePhoneState();
  }

  // M√©todos principales:
  // - void onPhoneNumberChanged(String)
  // - Future<void> validatePhoneNumber()
  // - void onVerificationCodeChanged(String)
  // - Future<void> verifyCode()
  // - Future<void> resendCode()
  // - Future<void> updatePhoneNumber()
}

enum ChangePhoneStatus {
  initial,      // Estado inicial
  validating,   // Validando n√∫mero (paso 1)
  awaitingSms,  // Esperando c√≥digo SMS
  validatingCode, // Validando c√≥digo (paso 2)
  updating,     // Actualizando n√∫mero
  success,      // √âxito
  error,        // Error
  expired,      // C√≥digo expirado
}

@freezed
class ChangePhoneState with _$ChangePhoneState {
  const factory ChangePhoneState({
    @Default(ChangePhoneStatus.initial) ChangePhoneStatus status,
    @Default('') String phoneNumber,
    @Default('') String requestId,
    @Default(false) bool isPhoneValid,
    @Default(false) bool isCodeValid,
    String? errorMessage,
    String? successMessage,
    @Default(300) int remainingSeconds, // 5 minutos
    @Default('') String verificationCode,
  }) = _ChangePhoneState;
}
```

### üåê Repository (Acceso a Datos)

#### **ClientProfileRepository**

Clase responsable de la comunicaci√≥n con la API:

```dart
abstract class IClientProfileRepository {
  Future<String> updatePhoneNumber(String phoneNumber);
  Future<String> updatePassword(
    String currentPassword,
    String newPassword,
    String confirmNewPassword,
  );
  Future<String> updateAddress(AddressEntity address);
}

class ClientProfileRepository implements IClientProfileRepository {
  final HttpClient _httpClient;

  // POST /client/update-phone
  Future<String> updatePhoneNumber(String phoneNumber);

  // POST /client/update-password
  Future<String> updatePassword(
    String currentPassword,
    String newPassword,
    String confirmNewPassword,
  );

  // POST /client/update-address
  Future<String> updateAddress(AddressEntity address);
}
```

---

## Flujo Completo de Datos

### üîÑ Flujo de Actualizaci√≥n de Tel√©fono

```
ClientProfileScreen
  ‚Üì
ChangePhoneScreen (formulario inicial)
  ‚Üì
ChangePhoneNotifier (validatePhoneNumber)
  ‚Üì
PhoneValidationRepository (env√≠o SMS)
  ‚Üì
VerifySmsScreen (ingreso de c√≥digo)
  ‚Üì
ChangePhoneNotifier (verifyCode)
  ‚Üì
ClientProfileRepository (updatePhoneNumber)
  ‚Üì
AuthProvider (actualizaci√≥n de datos)
  ‚Üì
ClientProfileResultScreen (confirmaci√≥n)
```

### üîÑ Flujo de Actualizaci√≥n de Contrase√±a

```
ClientProfileScreen
  ‚Üì
ChangePasswordScreen (formulario completo)
  ‚Üì
ChangePasswordNotifier (validaci√≥n local)
  ‚Üì
ClientProfileRepository (updatePassword)
  ‚Üì
AuthProvider (actualizaci√≥n de sesi√≥n)
  ‚Üì
ClientProfileResultScreen (confirmaci√≥n)
```

### üîÑ Flujo de Actualizaci√≥n de Direcci√≥n

```
ClientProfileScreen
  ‚Üì
ChangeAddressScreen (formulario geogr√°fico)
  ‚Üì
ChangeAddressNotifier (carga de departamentos/municipios)
  ‚Üì
GeographicRepository (datos geogr√°ficos)
  ‚Üì
ChangeAddressNotifier (validaci√≥n y submit)
  ‚Üì
ClientProfileRepository (updateAddress)
  ‚Üì
AuthProvider (actualizaci√≥n de datos)
  ‚Üì
ClientProfileResultScreen (confirmaci√≥n)
```

### üìä Diagrama de Estados

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                ChangePhoneNotifier                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Estado: initial ‚Üí validating ‚Üí awaitingSms ‚Üí validatingCode ‚Üí updating ‚Üí success ‚îÇ
‚îÇ                                                               ‚Üë error ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Datos:                                                        ‚îÇ
‚îÇ  - phoneNumber: String (nuevo n√∫mero)                         ‚îÇ
‚îÇ  - requestId: String (ID de solicitud SMS)                    ‚îÇ
‚îÇ  - verificationCode: String (c√≥digo ingresado)                ‚îÇ
‚îÇ  - remainingSeconds: int (tiempo restante)                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Acciones:                                                     ‚îÇ
‚îÇ  - validatePhoneNumber(): Inicia flujo SMS                     ‚îÇ
‚îÇ  - verifyCode(): Valida c√≥digo ingresado                      ‚îÇ
‚îÇ  - updatePhoneNumber(): Aplica cambio final                   ‚îÇ
‚îÇ  - resendCode(): Reenv√≠a SMS si expira                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ChangePasswordNotifier                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Estado: initial ‚Üí validating ‚Üí success/error                   ‚îÇ
‚îÇ                                                               ‚Üë submit ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Datos:                                                        ‚îÇ
‚îÇ  - currentPassword: PasswordInput (validaci√≥n)                ‚îÇ
‚îÇ  - newPassword: PasswordInput (nueva contrase√±a)              ‚îÇ
‚îÇ  - confirmPassword: PasswordConfirmationInput (confirmaci√≥n)  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Acciones:                                                     ‚îÇ
‚îÇ  - onChangeCurrentPassword(): Validaci√≥n en tiempo real       ‚îÇ
‚îÇ  - onChangeNewPassword(): Validaci√≥n de fortaleza              ‚îÇ
‚îÇ  - submitPassword(): Env√≠o a backend                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Componentes y Pasos

### üì± Pantallas del Flujo

#### 1. üë§ ClientProfileScreen

-   **Ruta**: `/profile`
-   **Prop√≥sito**: Vista principal del perfil con todos los datos
-   **Funcionalidad**:
    -   Mostrar datos actuales del usuario
    -   Navegaci√≥n a formularios de actualizaci√≥n
    -   Cards organizadas por tipo de informaci√≥n
    -   Acceso r√°pido a opciones de cambio

#### 2. üè† ChangeAddressScreen

-   **Ruta**: `/change-address`
-   **Prop√≥sito**: Formulario para actualizar direcci√≥n
-   **Funcionalidad**:
    -   Selectores de departamento, municipio y distrito
    -   Campos de texto para calle, n√∫mero y colonia
    -   Carga din√°mica de datos geogr√°ficos
    -   Validaci√≥n en tiempo real

#### 3. üîê ChangePasswordScreen

-   **Ruta**: `/change-password`
-   **Prop√≥sito**: Formulario seguro para cambio de contrase√±a
-   **Funcionalidad**:
    -   Campo de contrase√±a actual
    -   Campos para nueva contrase√±a y confirmaci√≥n
    -   Indicadores de visibilidad
    -   Validaci√≥n de fortaleza

#### 4. üì± ChangePhoneScreen

-   **Ruta**: `/change-phone`
-   **Prop√≥sito**: Inicio del flujo de cambio de tel√©fono
-   **Funcionalidad**:
    -   Campo para nuevo n√∫mero telef√≥nico
    -   Validaci√≥n de formato
    -   Bot√≥n para enviar c√≥digo SMS
    -   Navegaci√≥n a verificaci√≥n

#### 5. üî¢ VerifySmsScreen

-   **Ruta**: `/verify-sms`
-   **Prop√≥sito**: Verificaci√≥n de c√≥digo SMS
-   **Funcionalidad**:
    -   Campos para c√≥digo de 6 d√≠gitos
    -   Temporizador de expiraci√≥n
    -   Opci√≥n de reenviar c√≥digo
    -   Validaci√≥n autom√°tica

#### 6. ‚úÖ ClientProfileResultScreen

-   **Ruta**: `/profile-result`
-   **Prop√≥sito**: Confirmaci√≥n de cambios realizados
-   **Funcionalidad**:
    -   Mensaje de √©xito o error
    -   Detalles del cambio realizado
    -   Opciones para continuar o reintentar
    -   Navegaci√≥n de retorno

### üß© Componentes Reutilizables

#### **ContactDataCard**

Componente para mostrar datos de contacto:

```dart
class ContactDataCard extends StatelessWidget {
  final UserEntity user;

  // Muestra: tel√©fono, email, opciones de cambio
}
```

#### **PersonalDataCard**

Componente para datos personales:

```dart
class PersonalDataCard extends StatelessWidget {
  final UserEntity user;

  // Muestra: nombre, DUI, fecha de nacimiento
}
```

#### **AddressCard**

Componente para direcci√≥n:

```dart
class AddressCard extends StatelessWidget {
  final UserEntity user;

  // Muestra: direcci√≥n completa con opci√≥n de editar
}
```

---

## APIs Utilizadas

### üì° Endpoints de API

#### **POST** `/client/update-phone`

**Prop√≥sito**: Iniciar proceso de actualizaci√≥n de tel√©fono

**Request Body**:

```json
{
    "phoneNumber": "+50371234567"
}
```

**Response Exitoso (200)**:

```json
{
    "message": "C√≥digo de verificaci√≥n enviado al nuevo n√∫mero",
    "requestId": "req_123456789"
}
```

#### **POST** `/client/update-password`

**Prop√≥sito**: Actualizar contrase√±a del usuario

**Request Body**:

```json
{
    "old_password": "contrase√±a_actual123",
    "password": "nueva_contrase√±a456",
    "password_confirmation": "nueva_contrase√±a456"
}
```

**Response Exitoso (200)**:

```json
{
    "message": "Contrase√±a actualizada exitosamente"
}
```

**Error 422 (Validaci√≥n)**:

```json
{
    "errors": [
        {
            "message": "La contrase√±a actual es incorrecta"
        }
    ]
}
```

#### **POST** `/client/update-address`

**Prop√≥sito**: Actualizar direcci√≥n del usuario

**Request Body**:

```json
{
    "street": "Calle Los Pinos",
    "street_number": "123",
    "municipality": "San Salvador",
    "suburb": "Colonia Escal√≥n",
    "department": "San Salvador",
    "district": "Distrito 5"
}
```

**Response Exitoso (200)**:

```json
{
    "message": "Direcci√≥n actualizada exitosamente"
}
```

### üîí Headers de Seguridad

```http
POST /client/update-password HTTP/1.1
Host: api.pisto.co
Authorization: Bearer {jwt_token}
Content-Type: application/json
X-Client-Version: 1.0.0
X-Device-ID: {device_identifier}
```

---

## Manejo de Errores

### ‚ö†Ô∏è Tipos de Errores

#### **1. Errores de Validaci√≥n**

```dart
// Contrase√±a incorrecta
InvalidPasswordException {
  message: "La contrase√±a actual es incorrecta",
  suggestion: "Verifica tu contrase√±a e intenta nuevamente",
}

// Contrase√±a d√©bil
WeakPasswordException {
  message: "La nueva contrase√±a no cumple los requisitos de seguridad",
  requirements: ["M√≠nimo 8 caracteres", "Incluir n√∫meros y may√∫sculas"],
}

// Tel√©fono inv√°lido
InvalidPhoneException {
  message: "El formato del n√∫mero telef√≥nico es inv√°lido",
  example: "Formato esperado: +503XXXXXXX",
}
```

#### **2. Errores de SMS**

```dart
// SMS no enviado
SmsNotSentException {
  message: "No se pudo enviar el c√≥digo SMS",
  suggestion: "Verifica tu n√∫mero e intenta nuevamente",
  canRetry: true,
}

// C√≥digo incorrecto
InvalidCodeException {
  message: "El c√≥digo ingresado es incorrecto",
  attemptsRemaining: 2,
}

// C√≥digo expirado
CodeExpiredException {
  message: "El c√≥digo ha expirado",
  canResend: true,
  waitTime: 60, // segundos
}
```

#### **3. Errores de Conectividad**

```dart
// Error de red
NetworkException {
  message: "Error de conexi√≥n. Verifica tu conectividad.",
  canRetry: true,
  retryCallback: () => ref.refresh(changePasswordProvider),
}

// Timeout
TimeoutException {
  message: "Tiempo de espera agotado. Intente nuevamente.",
  canRetry: true,
  retryDelay: Duration(seconds: 5),
}
```

#### **4. Errores de Autenticaci√≥n**

```dart
// No autenticado
UnauthorizedException {
  message: "Usuario no autenticado",
  action: "redirect_to_login",
}

// Sesi√≥n expirada
SessionExpiredException {
  message: "Tu sesi√≥n ha expirado. Inicia sesi√≥n nuevamente.",
  action: "force_logout",
}
```

### üîÑ Estrategias de Recuperaci√≥n

#### **Reintentos Autom√°ticos**

```dart
class ProfileUpdateRetryStrategy {
  static const int maxRetries = 3;
  static const Duration baseDelay = Duration(seconds: 2);

  static Future<String> retryWithBackoff(
    Future<String> Function() updateCall,
  ) async {
    for (int attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await updateCall();
      } catch (e) {
        if (attempt == maxRetries) rethrow;

        final delay = baseDelay * math.pow(2, attempt - 1);
        await Future.delayed(delay);
      }
    }
    throw ClientProfileException(
      'No se pudo completar la actualizaci√≥n despu√©s de $maxRetries intentos',
    );
  }
}
```

#### **Fallback para Usuario**

-   **Opci√≥n de reintentar manual** la actualizaci√≥n
-   **Guardar borrador** para continuar m√°s tarde
-   **Contactar soporte** con diagn√≥stico autom√°tico
-   **Modo offline** con sincronizaci√≥n cuando haya conexi√≥n

---

## Validaciones

### ‚úÖ Validaciones Implementadas

1. **Validaci√≥n de Contrase√±a**

    - M√≠nimo 8 caracteres
    - Al menos una may√∫scula
    - Al menos un n√∫mero
    - No igual a la contrase√±a actual
    - Confirmaci√≥n coincidente

2. **Validaci√≥n de Tel√©fono**

    - Formato internacional (+503XXXXXXX)
    - Solo d√≠gitos despu√©s del c√≥digo de pa√≠s
    - Longitud v√°lida para El Salvador
    - No duplicado con otros usuarios

3. **Validaci√≥n de Direcci√≥n**
    - Departamento v√°lido
    - Municipio v√°lido para el departamento
    - Distrito v√°lido para el municipio
    - Campos de texto no vac√≠os

### üîç L√≥gica de Validaci√≥n

#### **Validaci√≥n de Contrase√±a**

```dart
class PasswordValidator {
  static PasswordValidationError? validate(String value) {
    if (value.isEmpty) {
      return PasswordValidationError.empty;
    }

    if (value.length < 8) {
      return PasswordValidationError.tooShort;
    }

    if (!RegExp(r'[A-Z]').hasMatch(value)) {
      return PasswordValidationError.noUppercase;
    }

    if (!RegExp(r'[0-9]').hasMatch(value)) {
      return PasswordValidationError.noNumbers;
    }

    return null; // V√°lida
  }

  static bool isStrongPassword(String password) {
    return validate(password) == null;
  }
}
```

#### **Validaci√≥n de Tel√©fono**

```dart
class PhoneValidator {
  static PhoneValidationError? validate(String value) {
    if (value.isEmpty) {
      return PhoneValidationError.empty;
    }

    if (!RegExp(r'^\+503[67]\d{7}$').hasMatch(value)) {
      return PhoneValidationError.invalidFormat;
    }

    return null; // V√°lido
  }

  static String formatPhoneNumber(String rawNumber) {
    // Formatea a +503XXXXXXX
    return '+503${rawNumber.replaceAll(RegExp(r'[^\d]'), '')}';
  }
}
```

#### **Validaci√≥n de Direcci√≥n**

```dart
class AddressValidator {
  static AddressValidationError? validate(AddressEntity address) {
    if (address.street.isEmpty) {
      return AddressValidationError.emptyStreet;
    }

    if (address.streetNumber.isEmpty) {
      return AddressValidationError.emptyStreetNumber;
    }

    if (!_isValidDepartment(address.department)) {
      return AddressValidationError.invalidDepartment;
    }

    if (!_isValidMunicipality(address.municipality, address.department)) {
      return AddressValidationError.invalidMunicipality;
    }

    return null; // V√°lida
  }
}
```

### üõ°Ô∏è Consideraciones de Seguridad

-   Validaci√≥n de contrase√±a actual para cambios
-   Verificaci√≥n por SMS para cambios de tel√©fono
-   L√≠mite de intentos para prevenir ataques
-   Auditor√≠a completa de todos los cambios
-   Encriptaci√≥n de datos sensibles en tr√°nsito

---

## Testing

### üß™ Estrategia de Testing

#### **1. Unit Tests**

```dart
// test/unit/client_profile_test.dart
void main() {
  group('ChangePasswordNotifier', () {
    test('debe validar contrase√±a correctamente', () {
      // Test de validaci√≥n de fortaleza
    });

    test('debe rechazar contrase√±a igual a actual', () {
      // Test de validaci√≥n de duplicidad
    });

    test('debe manejar error de contrase√±a incorrecta', () {
      // Test de manejo de errores de API
    });
  });
}
```

#### **2. Widget Tests**

```dart
// test/widget/change_password_screen_test.dart
void main() {
  testWidgets('debe mostrar error con contrase√±a d√©bil', (tester) async {
    // Test de validaci√≥n visual
  });

  testWidgets('deve mostrar √©xito al cambiar contrase√±a', (tester) async {
    // Test de flujo exitoso
  });
}
```

#### **3. Integration Tests**

```dart
// test/integration/profile_update_flow_test.dart
void main() {
  integrationTest('flujo completo de cambio de tel√©fono', () async {
    // Simular: perfil ‚Üí tel√©fono ‚Üí SMS ‚Üí verificaci√≥n ‚Üí √©xito
  });

  integrationTest('manejo de expiraci√≥n de SMS', () async {
    // Test de flujo con c√≥digo expirado
  });
}
```

### üìã Casos de Prueba Cr√≠ticos

#### **Flujos de Usuario**

-   ‚úÖ Usuario cambia contrase√±a exitosamente
-   ‚úÖ Usuario actualiza tel√©fono con verificaci√≥n SMS
-   ‚úÖ Usuario modifica direcci√≥n con datos geogr√°ficos
-   ‚úÖ Usuario maneja error de contrase√±a incorrecta
-   ‚úÖ Usuario reintenta despu√©s de fallo de red

#### **Casos L√≠mite**

-   üîÑ Contrase√±a con formato inv√°lido
-   üîÑ SMS expirado durante verificaci√≥n
-   üîÑ Direcci√≥n con municipio inv√°lido
-   üîÑ M√∫ltiples intentos de cambio fallidos
-   üîÑ Sesi√≥n expirada durante actualizaci√≥n

### üìä M√©tricas de Testing

-   **Cobertura m√≠nima**: 85% para l√≥gica de validaci√≥n
-   **Tests de seguridad**: 100% de validaciones cr√≠ticas
-   **Tests de error**: Todos los tipos de error cubiertos
-   **Tests de UI**: Interacciones cr√≠ticas del usuario

---

## Seguridad

### üîí Caracter√≠sticas de Seguridad

#### **1. Protecci√≥n de Datos**

-   ‚úÖ **Autenticaci√≥n obligatoria**: Solo usuarios validados
-   ‚úÖ **Verificaci√≥n por SMS**: Para cambios cr√≠ticos
-   ‚úÖ **Validaci√≥n de contrase√±a**: Confirmaci√≥n de identidad
-   ‚úÖ **Encriptaci√≥n en tr√°nsito**: Todos los datos viajan por HTTPS

#### **2. Control de Acceso**

-   ‚úÖ **Validaci√≥n de sesi√≥n**: Token JWT requerido
-   ‚úÖ **Rate limiting**: L√≠mite de intentos por tiempo
-   ‚úÖ **Auditor√≠a completa**: Registro de todos los cambios
-   ‚úÖ **Timeout de sesi√≥n**: Cierre autom√°tico por inactividad

#### **3. Validaciones de Seguridad**

```dart
class ProfileSecurityValidator {
  static bool canUpdateProfile(
    UserEntity user,
    ProfileUpdateType updateType,
  ) {
    // Validar que el usuario est√° autenticado
    if (user.id == null) return false;

    // Validar que no hay cambios recientes sospechosos
    if (_hasRecentSuspiciousActivity(user)) return false;

    // Validar tipo de actualizaci√≥n permitida
    return _isAllowedUpdateType(updateType);
  }

  static bool validatePasswordChange(
    String currentPassword,
    String newPassword,
    String hashedPassword,
  ) {
    // Verificar contrase√±a actual
    if (!_verifyCurrentPassword(currentPassword, hashedPassword)) {
      return false;
    }

    // Validar que la nueva es diferente
    if (currentPassword == newPassword) {
      return false;
    }

    return true;
  }
}
```

### üõ°Ô∏è Consideraciones de Privacidad

-   Los datos personales son sensibles y requieren autenticaci√≥n
-   Los cambios cr√≠ticos requieren verificaci√≥n adicional
-   Auditor√≠a completa para cumplimiento normativo
-   Encriptaci√≥n de datos en reposo y tr√°nsito

### üîê Best Practices Implementadas

```dart
// Ejemplo de implementaci√≥n segura
class SecureProfileService {
  Future<ProfileUpdateResult> updatePasswordSecurely(
    String currentPassword,
    String newPassword,
    UserContext user,
  ) async {
    try {
      // 1. Validar autenticaci√≥n
      await _validateAuthentication(user);

      // 2. Validar seguridad de contrase√±a
      if (!_securityValidator.isStrongPassword(newPassword)) {
        return ProfileUpdateResult.failure(
          'La contrase√±a no cumple los requisitos de seguridad',
        );
      }

      // 3. Verificar contrase√±a actual
      if (!_securityValidator.verifyCurrentPassword(currentPassword, user.hashedPassword)) {
        return ProfileUpdateResult.failure('La contrase√±a actual es incorrecta');
      }

      // 4. Actualizar con seguridad
      final result = await _repository.updatePassword(
        currentPassword,
        newPassword,
        newPassword, // confirmaci√≥n
      );

      // 5. Registrar para auditor√≠a
      _auditLogger.logPasswordChange(user.id, result);

      return ProfileUpdateResult.success(result);
    } catch (e) {
      _auditLogger.logPasswordError(user.id, e);
      throw SecureProfileException.fromError(e);
    }
  }
}
```

---

## üöÄ Implementaci√≥n y Mantenimiento

### üì¶ Dependencias Clave

```yaml
dependencies:
    flutter_riverpod: ^2.4.0 # Gesti√≥n de estado
    formz: ^0.6.0 # Validaci√≥n de formularios
    freezed_annotation: ^2.4.0 # Modelos inmutables
    json_annotation: ^4.8.0 # Serializaci√≥n JSON
    dio: ^5.3.0 # Cliente HTTP

dev_dependencies:
    riverpod_generator: ^2.3.0 # Code generation
    freezed: ^2.4.0 # Generaci√≥n de modelos
    json_serializable: ^6.7.0 # Generaci√≥n JSON
    build_runner: ^2.4.0 # Herramienta de generaci√≥n
```

### üîß Comandos de Desarrollo

```bash
# Generar c√≥digo (requerido despu√©s de cambios)
dart run build_runner build --delete-conflicting-outputs

# Modo watch durante desarrollo
dart run build_runner watch -d

# Ejecutar pruebas
flutter test test/features/client_profile/

# An√°lisis est√°tico
flutter analyze lib/features/client_profile/
```

### üìù Mejores Pr√°cticas

1. **Code Generation**: Siempre ejecutar `build_runner` despu√©s de modificar modelos o providers
2. **State Management**: Usar `keepAlive: true` para persistencia cr√≠tica
3. **Validation**: Validaci√≥n local y backend para mejor UX
4. **Security**: Verificaci√≥n obligatoria para cambios cr√≠ticos
5. **Testing**: Mantener cobertura >85% para l√≥gica de negocio
6. **Error Handling**: Manejo espec√≠fico para cada tipo de actualizaci√≥n

---

## üîó Integraciones

### üìÑ M√≥dulos que utilizan Client Profile

#### **Auth**

-   Actualizaci√≥n de datos del usuario autenticado
-   Sincronizaci√≥n de cambios de perfil
-   Manejo de sesiones y tokens

#### **My Loan**

-   Validaci√≥n de datos de contacto
-   Verificaci√≥n de direcci√≥n para pr√©stamos
-   Confirmaci√≥n de identidad

#### **Contact**

-   Uso de datos de contacto actualizados
-   Validaci√≥n de informaci√≥n del usuario

#### **Geographic**

-   Datos de departamentos y municipios
-   Validaci√≥n de direcciones geogr√°ficas

#### **Phone Validation**

-   Env√≠o de c√≥digos SMS
-   Verificaci√≥n de n√∫meros telef√≥nicos

### üîÑ Flujo de Datos

```
ClientProfileScreen
  ‚Üì
Specific Provider (Address/Password/Phone)
  ‚Üì
ClientProfileRepository (API calls)
  ‚Üì
AuthProvider (data synchronization)
  ‚Üì
Updated User State
```
