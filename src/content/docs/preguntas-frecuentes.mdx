---
title: Flujo de preguntas frecuentes
slug: preguntas-frecuentes
tags: [auth, flutter, riverpod, dio, formz, go_router, freezed, json_annotation]
description: Flujo de preguntas frecuentes. GestiÃ³n completa del proceso de consulta y respuesta de preguntas frecuentes.
---

## DescripciÃ³n General

La funcionalidad de **Preguntas Frecuentes** (`faq`) es el sistema centralizado de ayuda y soporte que proporciona a los usuarios acceso instantÃ¡neo a informaciÃ³n importante sobre la plataforma Pisto. Este mÃ³dulo ofrece una interfaz intuitiva para consultar respuestas predefinidas sobre prÃ©stamos, pagos, seguridad, cuenta y otros temas relevantes, permitiendo a los usuarios resolver dudas comunes de forma autÃ³noma sin necesidad de contactar soporte tÃ©cnico.

### ğŸ“Š Estructura del Flujo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MenÃº Principal   â”‚â”€â”€â”€â”€â–¶â”‚ Pantalla FAQ     â”‚â”€â”€â”€â”€â–¶â”‚ Lista de         â”‚â”€â”€â”€â”€â–¶â”‚ ExpansiÃ³n de     â”‚â”€â”€â”€â”€â–¶â”‚ Lectura de       â”‚
â”‚ (NavegaciÃ³n)    â”‚     â”‚ (Carga inicial)  â”‚     â”‚ Preguntas        â”‚     â”‚ Respuesta        â”‚     â”‚ Respuesta        â”‚
â”‚                 â”‚     â”‚                     â”‚     â”‚                     â”‚     â”‚                     â”‚     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     âœ“ Acceso rÃ¡pido      âœ“ Carga desde API    âœ“ TÃ­tulos visibles     âœ“ Contenido completo   âœ“ InformaciÃ³n clara
```

### âœ¨ CaracterÃ­sticas Principales

-   âœ… **Acceso centralizado**: Ãšnico punto para todas las preguntas y respuestas
-   âœ… **Carga dinÃ¡mica**: Contenido actualizado desde backend en tiempo real
-   âœ… **Interfaz expandible**: DiseÃ±o acordeÃ³n para fÃ¡cil navegaciÃ³n
-   âœ… **BÃºsqueda visual**: OrganizaciÃ³n clara por categorÃ­as implÃ­citas
-   âœ… **ActualizaciÃ³n automÃ¡tica**: Pull-to-refresh para obtener contenido nuevo
-   âœ… **Manejo robusto de errores**: RecuperaciÃ³n ante fallos de carga
-   âœ… **DiseÃ±o responsive**: Optimizado para diferentes tamaÃ±os de pantalla
-   âœ… **Experiencia offline**: Indicadores claros cuando no hay conexiÃ³n

---

## GuÃ­a del Usuario

### ğŸ¯ Â¿Para quÃ© sirven las preguntas frecuentes?

Las preguntas frecuentes te permiten:

-   **Resolver dudas rÃ¡pidas**: Respuestas inmediatas a preguntas comunes
-   **Aprender sobre prÃ©stamos**: InformaciÃ³n sobre procesos y requisitos
-   **Entender pagos**: Detalles sobre fechas, montos y mÃ©todos
-   **Conocer seguridad**: CÃ³mo proteger tu cuenta y datos
-   **Gestionar tu perfil**: Actualizar datos y configuraciÃ³n
-   **Evitar esperas**: Solucionar problemas sin contactar soporte

### ğŸ“± CÃ³mo usar las preguntas frecuentes

#### Paso 1: Acceder a las preguntas frecuentes

Para encontrar respuestas a tus dudas:

**Desde el menÃº principal:**

1. ğŸ  **Abre el menÃº lateral** - Toca el Ã­cono de hamburguesa (â˜°)
2. â“ **Busca "Preguntas frecuentes"** - Encuentra la opciÃ³n en el menÃº
3. ğŸ‘† **Presiona la opciÃ³n** - AccederÃ¡s a la pantalla de ayuda
4. ğŸ“Š **Espera la carga** - Las preguntas se cargarÃ¡n automÃ¡ticamente

**CaracterÃ­sticas de acceso:**

-   âš¡ **Carga rÃ¡pida** - Las respuestas aparecen en segundos
-   ğŸ”„ **ActualizaciÃ³n automÃ¡tica** - Siempre contenido al dÃ­a
-   ğŸ“± **Disponible offline** - Algunas respuestas pueden estar cacheadas

#### Paso 2: Navegar por las preguntas

Una vez en la pantalla de preguntas frecuentes:

**ExploraciÃ³n del contenido:**

1. ğŸ‘€ **Revisa los tÃ­tulos** - Las preguntas aparecen como tÃ­tulos expandibles
2. ğŸ“‹ **Identifica tu duda** - Busca la pregunta que se acerca a tu problema
3. ğŸ‘† **Toca la pregunta** - La respuesta se expandirÃ¡ automÃ¡ticamente
4. ğŸ“– **Lee la respuesta completa** - InformaciÃ³n detallada y clara

**OrganizaciÃ³n visual:**

-   ğŸ“ **TÃ­tulos en negrita** - FÃ¡ciles de identificar rÃ¡pidamente
-   ğŸ”µ **Color consistente** - DiseÃ±o profesional y legible
-   ğŸ“± **Interfaz tÃ¡ctil** - Optimizada para toque y expansiÃ³n
-   ğŸ”„ **Indicadores visuales** - Iconos que muestran estado expandido/contraÃ­do

#### Paso 3: Encontrar informaciÃ³n especÃ­fica

Para localizar respuestas a temas especÃ­ficos:

**CategorÃ­as comunes:**

-   ğŸ’° **PrÃ©stamos** - Solicitudes, aprobaciones, montos
-   ğŸ’³ **Pagos** - Fechas, mÃ©todos, confirmaciones
-   ğŸ” **Seguridad** - ContraseÃ±as, protecciÃ³n de datos
-   ğŸ‘¤ **Cuenta** - ActualizaciÃ³n de datos, configuraciÃ³n
-   ğŸ“± **AplicaciÃ³n** - Uso, funciones, problemas tÃ©cnicos
-   ğŸ¦ **General** - InformaciÃ³n sobre Pisto y servicios

**Tips de bÃºsqueda:**

-   ğŸ” **Lee los tÃ­tulos cuidadosamente** - Muchas dudas se resuelven con el tÃ­tulo
-   ğŸ“‹ **Revisa preguntas similares** - La respuesta puede estar en otra pregunta
-   ğŸ’¡ **Usa palabras clave** - Piensa en tÃ©rminos tÃ©cnicos y simples
-   ğŸ“Š **Explora todas las categorÃ­as** - No te limites a una secciÃ³n

#### Paso 4: Actualizar el contenido

Para obtener las respuestas mÃ¡s recientes:

**Pull-to-refresh:**

1. ğŸ“± **Desliza hacia abajo** - En la lista de preguntas
2. ğŸ”„ **Espera la actualizaciÃ³n** - El sistema cargarÃ¡ contenido nuevo
3. âœ… **Verifica cambios** - Revisa si hay nuevas preguntas o respuestas actualizadas

**Â¿CuÃ¡ndo actualizar?**

-   ğŸ“… **PeriÃ³dicamente** - Para mantenerse informado
-   ğŸ”„ **DespuÃ©s de actualizaciones** - Nuevas funciones pueden tener nuevas FAQs
-   â“ **Si no encuentras respuesta** - El contenido puede haber sido actualizado

#### Paso 5: Manejar problemas de carga

Si experimentas dificultades:

**Errores comunes:**

-   ğŸš« **Sin conexiÃ³n** - Mensaje claro de problemas de red
-   â° **Tiempo de espera** - La carga estÃ¡ tardando demasiado
-   ğŸ” **SesiÃ³n expirada** - Necesitas iniciar sesiÃ³n nuevamente
-   ğŸ“Š **Sin contenido** - No hay preguntas disponibles

**Soluciones:**

1. ğŸ”„ **Reintentar** - Toca el botÃ³n "Reintentar" para volver a cargar
2. ğŸ“± **Verificar conexiÃ³n** - AsegÃºrate de tener internet estable
3. ğŸ”‘ **Iniciar sesiÃ³n** - Si la sesiÃ³n expirÃ³, vuelve a entrar
4. â³ **Esperar y reintentar** - A veces el servidor estÃ¡ temporalmente ocupado

### âš ï¸ InformaciÃ³n importante

**Limitaciones del sistema:**

-   ğŸ“‹ **Solo preguntas predefinidas** - No admite preguntas personalizadas
-   ğŸ”„ **Depende de conexiÃ³n** - Requiere internet para cargar contenido
-   ğŸ“Š **Contenido estÃ¡tico** - Las respuestas no son interactivas
-   ğŸ” **Sin funciÃ³n de bÃºsqueda** - Debes navegar manualmente

**CuÃ¡ndo contactar soporte:**

-   â“ **Si no encuentras respuesta** - Tu duda puede ser especÃ­fica
-   ğŸ”§ **Problemas tÃ©cnicos** - Errores que no se resuelven con reintentar
-   ğŸ“± **Sugerencias** - Ideas para nuevas preguntas frecuentes
-   ğŸš¨ **Urgencias** - Problemas crÃ­ticos que requieren atenciÃ³n inmediata

---

## Arquitectura TÃ©cnica

### ğŸ—ï¸ Estructura del MÃ³dulo

El mÃ³dulo de preguntas frecuentes sigue una arquitectura simple y eficiente con separaciÃ³n clara de responsabilidades:

```
faq/
â”œâ”€â”€ entities/                    # Entidades de dominio
â”‚   â”œâ”€â”€ faq_entity.dart                    # Item individual de FAQ
â”‚   â””â”€â”€ entities.dart                       # Export de entidades
â”œâ”€â”€ models/                      # DTOs para API
â”‚   â”œâ”€â”€ faq_response.dart                   # Respuesta del endpoint
â”‚   â””â”€â”€ models.dart                          # Export de modelos
â”œâ”€â”€ providers/                   # GestiÃ³n de estado
â”‚   â”œâ”€â”€ faq_provider.dart                    # Provider principal
â”‚   â””â”€â”€ providers.dart                       # Export de providers
â”œâ”€â”€ repositories/               # Acceso a datos
â”‚   â”œâ”€â”€ faq_repository.dart                  # API de FAQs
â”‚   â””â”€â”€ repositories.dart                    # Export de repositories
â””â”€â”€ screens/                    # Interfaces de usuario
    â”œâ”€â”€ faq_screen.dart                       # Pantalla principal
    â””â”€â”€ screens.dart                          # Export de screens
```

### ğŸ“Š Entities (Entidades de Dominio)

#### **FaqItemEntity**

Entidad que representa un item individual de pregunta y respuesta:

```dart
class FaqItemEntity {
  final String question;          // Pregunta frecuente
  final String answer;            // Respuesta detallada

  FaqItemEntity({
    required this.question,
    required this.answer,
  });

  /// Factory para convertir desde API response
  factory FaqItemEntity.fromApiResponse(FaqItemResponse response) {
    return FaqItemEntity(
      question: response.question,
      answer: response.answer,
    );
  }

  /// Convertir lista de respuestas a entidades
  static List<FaqItemEntity> fromApiResponseList(
    List<FaqItemResponse> responses,
  ) {
    return responses
        .map((r) => FaqItemEntity.fromApiResponse(r))
        .toList();
  }

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is FaqItemEntity &&
          runtimeType == other.runtimeType &&
          question == other.question &&
          answer == other.answer;

  @override
  String toString() =>
      'FaqItemEntity{question: $question, answer: ${answer.substring(0, answer.length > 50 ? 50 : answer.length)}...}';
}
```

### ğŸ¯ Providers (GestiÃ³n de Estado)

#### **faqsProvider**

FutureProvider simple para carga automÃ¡tica de FAQs:

```dart
@riverpod
Future<List<FaqItemEntity>> faqs(Ref ref) async {
  final repository = ref.watch(faqRepositoryProvider);
  final response = await repository.getFaqs();
  return FaqItemEntity.fromApiResponseList(response.data);
}
```

**CaracterÃ­sticas del Provider:**

-   âœ… **Manejo automÃ¡tico de estados**: loading, data, error
-   âœ… **Cache incorporado**: Evita cargas innecesarias
-   âœ… **Reactividad**: Se actualiza automÃ¡ticamente con ref.refresh()
-   âœ… **Error handling**: Propaga excepciones automÃ¡ticamente

### ğŸŒ Repository (Acceso a Datos)

#### **FaqRepository**

Clase responsable de la comunicaciÃ³n con la API:

```dart
class FaqRepository {
  final HttpClient _httpClient;

  FaqRepository(this._httpClient);

  /// Obtiene todas las preguntas frecuentes
  /// Endpoint: GET /client/help
  Future<FaqResponse> getFaqs() async {
    try {
      final response = await _httpClient.get('/client/help');
      return FaqResponse.fromJson(response.data);
    } on DioException catch (e) {
      if (e.response?.statusCode == 401) {
        throw FaqException(
          'SesiÃ³n expirada. Por favor, inicia sesiÃ³n nuevamente.',
          401,
        );
      }
      if (e.type == DioExceptionType.connectionTimeout) {
        throw FaqException('Tiempo de conexiÃ³n agotado. Verifica tu internet.');
      }
      throw FaqException(
        e.response?.data['message'] ?? 'Error al cargar preguntas frecuentes',
        e.response?.statusCode,
      );
    } catch (e) {
      throw FaqException('Error inesperado: $e');
    }
  }
}

@riverpod
FaqRepository faqRepository(Ref ref) {
  final httpClient = ref.watch(httpClientProvider);
  return FaqRepository(httpClient);
}
```

### ğŸ“± Models (DTOs)

#### **FaqResponse**

Modelo para la respuesta completa del endpoint:

```dart
class FaqResponse {
  final List<FaqItemResponse> data;

  FaqResponse({required this.data});

  factory FaqResponse.fromJson(Map<String, dynamic> json) => FaqResponse(
        data: List<FaqItemResponse>.from(
          json["data"].map((x) => FaqItemResponse.fromJson(x)),
        ),
      );

  Map<String, dynamic> toJson() => {
        "data": List<dynamic>.from(data.map((x) => x.toJson())),
      };
}

class FaqItemResponse {
  final String question;
  final String answer;

  FaqItemResponse({
    required this.question,
    required this.answer,
  });

  factory FaqItemResponse.fromJson(Map<String, dynamic> json) =>
      FaqItemResponse(
        question: json["question"],
        answer: json["answer"],
      );

  Map<String, dynamic> toJson() => {
        "question": question,
        "answer": answer,
      };
}
```

---

## Flujo Completo de Datos

### ğŸ”„ Flujo de Carga de FAQs

```
AppSidebarLayout (menÃº lateral)
  â†“
FaqScreen (pantalla principal)
  â†“
faqsProvider (FutureProvider)
  â†“
FaqRepository (getFaqs)
  â†“
HttpClient (GET /client/help)
  â”œâ”€â†’ AutenticaciÃ³n (token JWT)
  â”œâ”€â†’ Obtener lista de FAQs
  â””â”€â†’ Respuesta JSON con preguntas y respuestas
  â†“
FaqResponse (deserializaciÃ³n)
  â†“
FaqItemEntity.fromApiResponseList (conversiÃ³n a entidades)
  â†“
Lista de FaqItemEntity (datos para UI)
  â†“
FaqScreen.when() (manejo de estados)
  â”œâ”€â†’ loading: CircularProgressIndicator
  â”œâ”€â†’ error: Pantalla de error con retry
  â””â”€â†’ data: ListView con ExpansionTiles
```

### ğŸ”„ Flujo de ActualizaciÃ³n (Pull-to-refresh)

```
Usuario desliza hacia abajo (RefreshIndicator)
  â†“
onRefresh callback
  â†“
ref.refresh(faqsProvider.future)
  â†“
InvalidaciÃ³n de cache del provider
  â†“
Re-ejecuciÃ³n del FutureProvider
  â†“
Nueva llamada a getFaqs()
  â†“
ActualizaciÃ³n del contenido en pantalla
```

### ğŸ“Š Diagrama de Estados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       faqsProvider                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Estado: FutureProvider<List<FaqItemEntity>>                    â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Estados automÃ¡ticos:                                           â”‚
â”‚  - loading: CircularProgressIndicator()                             â”‚
â”‚  - error: ErrorWidget con botÃ³n de retry                       â”‚
â”‚  - data: ListView.builder con ExpansionTiles                   â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Datos:                                                        â”‚
â”‚  - List<FaqItemEntity>: Lista de preguntas y respuestas        â”‚
â”‚  - Cache automÃ¡tico: Evita cargas repetitivas                  â”‚
â”‚  - Refresco manual: ref.refresh()                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Acciones:                                                     â”‚
â”‚  - Carga inicial: AutomÃ¡tica al montar la pantalla             â”‚
â”‚  - Refresco: Pull-to-refresh o ref.refresh()                   â”‚
â”‚  - Manejo de errores: PropagaciÃ³n automÃ¡tica                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Componentes y Pasos

### ğŸ“± Pantallas del Flujo

#### 1. â“ FaqScreen

-   **Ruta**: `/faq`
-   **PropÃ³sito**: Pantalla principal con lista de preguntas frecuentes
-   **Funcionalidad**:
    -   Carga automÃ¡tica de FAQs desde backend
    -   DiseÃ±o acordeÃ³n con ExpansionTiles
    -   Pull-to-refresh para actualizar contenido
    -   Manejo de estados loading/error/data
    -   DiseÃ±o responsive y accesible

**Componentes principales:**

```dart
class FaqScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final faqState = ref.watch(faqsProvider);

    return AppLayout(
      title: 'Preguntas frecuentes',
      child: faqState.when(
        data: (faqs) => _buildFaqList(faqs),
        error: (error, stack) => _buildErrorWidget(error),
        loading: () => const Center(child: CircularProgressIndicator()),
      ),
    );
  }
}
```

#### **\_buildFaqList()**

Renderizado de la lista de preguntas:

```dart
Widget _buildFaqList(List<FaqItemEntity> faqs) {
  if (faqs.isEmpty) {
    return const Center(
      child: Text('No hay preguntas frecuentes disponibles'),
    );
  }

  return RefreshIndicator(
    onRefresh: () => ref.refresh(faqsProvider.future),
    child: ListView.builder(
      itemCount: faqs.length,
      itemBuilder: (context, index) {
        final faq = faqs[index];
        return ExpansionTile(
          title: Text(faq.question),
          children: [
            Padding(
              padding: const EdgeInsets.all(16),
              child: Text(faq.answer),
            ),
          ],
        );
      },
    ),
  );
}
```

#### **\_buildErrorWidget()**

Manejo de errores con opciÃ³n de reintentar:

```dart
Widget _buildErrorWidget(Object error) {
  return Center(
    child: Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        const Icon(Icons.error_outline, size: 64),
        const SizedBox(height: 16),
        Text(
          error.toString().replaceAll('FaqException: ', ''),
          textAlign: TextAlign.center,
        ),
        const SizedBox(height: 24),
        PrimaryBtn(
          text: 'Reintentar',
          onPressed: () => ref.refresh(faqsProvider),
        ),
      ],
    ),
  );
}
```

### ğŸ§© Componentes Reutilizables

#### **ExpansionTile personalizado**

Componente acordeÃ³n para preguntas y respuestas:

```dart
ExpansionTile(
  tilePadding: const EdgeInsets.symmetric(horizontal: 12, vertical: 8),
  iconColor: AppTheme.darkBlue,
  collapsedIconColor: AppTheme.darkBlue,
  title: Text(
    faq.question,
    style: const TextStyle(
      color: AppTheme.darkBlue,
      fontSize: 16,
      fontWeight: FontWeight.w700,
    ),
  ),
  children: [
    Container(
      padding: const EdgeInsets.all(16),
      child: Text(
        faq.answer,
        style: const TextStyle(
          color: AppTheme.darkBlue,
          fontSize: 15,
          fontWeight: FontWeight.w400,
          height: 1.5,
        ),
      ),
    ),
  ],
)
```

---

## APIs Utilizadas

### ğŸ“¡ Endpoints de API

#### **GET** `/client/help`

**PropÃ³sito**: Obtener todas las preguntas frecuentes disponibles

**Headers Requeridos**:

```http
GET /client/help HTTP/1.1
Host: api.pisto.co
Authorization: Bearer {jwt_token}
Content-Type: application/json
X-Client-Version: 1.0.0
X-Device-ID: {device_identifier}
```

**Response Exitoso (200)**:

```json
{
    "data": [
        {
            "question": "Â¿CÃ³mo solicito un prÃ©stamo?",
            "answer": "Para solicitar un prÃ©stamo, sigue estos pasos: 1. Inicia sesiÃ³n en la app, 2. Ve a la secciÃ³n 'Mi PrÃ©stamo', 3. Completa el formulario con tus datos, 4. Espera la aprobaciÃ³n, 5. Recibe el dinero en tu cuenta."
        },
        {
            "question": "Â¿CuÃ¡les son los requisitos para obtener un prÃ©stamo?",
            "answer": "Los requisitos son: 1. Ser mayor de 18 aÃ±os, 2. Tener DUI vigente, 3. Contar con cuenta bancaria, 4. Demostrar ingresos mensuales, 5. NÃºmero de telÃ©fono activo."
        },
        {
            "question": "Â¿CÃ³mo realizo el pago de mi prÃ©stamo?",
            "answer": "Puedes pagar tu prÃ©stamo mediante: 1. Transferencia bancaria, 2. DepÃ³sito en cuenta, 3. Puntos de pago autorizados, 4. DÃ©bito automÃ¡tico. Elige el mÃ©todo que prefieras en la secciÃ³n 'Pagos'."
        }
    ]
}
```

**Error 401 (Unauthorized)**:

```json
{
    "message": "SesiÃ³n expirada. Por favor, inicia sesiÃ³n nuevamente."
}
```

**Error 500 (Server Error)**:

```json
{
    "message": "Error al cargar preguntas frecuentes"
}
```

### ğŸ”’ CaracterÃ­sticas de la API

-   **AutenticaciÃ³n requerida**: Solo usuarios autenticados pueden acceder
-   **Respuesta cacheada**: El contenido puede permanecer cacheado por tiempo
-   **ActualizaciÃ³n dinÃ¡mica**: El backend puede actualizar las FAQs sin actualizar la app
-   **Estructura simple**: Array de objetos con question y answer
-   **Sin paginaciÃ³n**: Todas las FAQs se entregan en una sola respuesta

---

## Manejo de Errores

### âš ï¸ Tipos de Errores

#### **1. Errores de Conectividad**

```dart
// Timeout de conexiÃ³n
ConnectionTimeoutException {
  message: "Tiempo de conexiÃ³n agotado. Verifica tu internet.",
  canRetry: true,
  retryCallback: () => ref.refresh(faqsProvider),
}

// Error de red
NetworkException {
  message: "Error de conexiÃ³n. Verifica tu conectividad.",
  canRetry: true,
  retryDelay: Duration(seconds: 3),
}
```

#### **2. Errores de AutenticaciÃ³n**

```dart
// SesiÃ³n expirada
SessionExpiredException {
  message: "SesiÃ³n expirada. Por favor, inicia sesiÃ³n nuevamente.",
  action: "redirect_to_login",
  statusCode: 401,
}

// No autenticado
UnauthorizedException {
  message: "Usuario no autenticado",
  action: "force_logout",
}
```

#### **3. Errores del Servidor**

```dart
// Error interno
ServerException {
  message: "Error al cargar preguntas frecuentes",
  canRetry: true,
  retryAfter: 300, // 5 minutos
}

// Servicio no disponible
ServiceUnavailableException {
  message: "Servicio temporalmente no disponible",
  canRetry: true,
  retryAfter: 600, // 10 minutos
}
```

#### **4. Errores de Datos**

```dart
// Respuesta vacÃ­a
EmptyResponseException {
  message: "No hay preguntas frecuentes disponibles",
  canRetry: false,
}

// Formato invÃ¡lido
InvalidFormatException {
  message: "Error en el formato de los datos",
  canRetry: true,
}
```

### ğŸ”„ Estrategias de RecuperaciÃ³n

#### **Reintentos AutomÃ¡ticos**

```dart
class FaqRetryStrategy {
  static const int maxRetries = 3;
  static const Duration baseDelay = Duration(seconds: 2);

  static Future<List<FaqItemEntity>> retryWithBackoff(
    Future<List<FaqItemEntity>> Function() faqCall,
  ) async {
    for (int attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await faqCall();
      } catch (e) {
        if (attempt == maxRetries) rethrow;

        final delay = baseDelay * math.pow(2, attempt - 1);
        await Future.delayed(delay);
      }
    }
    throw FaqException(
      'No se pudieron cargar las FAQs despuÃ©s de $maxRetries intentos',
    );
  }
}
```

#### **Fallback para Usuario**

-   **BotÃ³n de reintentar manual** en pantalla de error
-   **Indicador claro del problema** con mensaje especÃ­fico
-   **OpciÃ³n de contactar soporte** si el problema persiste
-   **Cache local** temporal para mostrar contenido anterior

---

## Validaciones

### âœ… Validaciones Implementadas

1. **ValidaciÃ³n de AutenticaciÃ³n**

    - VerificaciÃ³n de token JWT vÃ¡lido
    - ConfirmaciÃ³n de sesiÃ³n activa
    - Manejo de tokens expirados

2. **ValidaciÃ³n de Respuesta**

    - Estructura JSON correcta
    - Campos obligatorios presentes
    - Tipos de datos vÃ¡lidos

3. **ValidaciÃ³n de Contenido**
    - Preguntas no vacÃ­as
    - Respuestas con contenido mÃ­nimo
    - Formato de texto seguro

### ğŸ” LÃ³gica de ValidaciÃ³n

#### **ValidaciÃ³n de Respuesta API**

```dart
class FaqResponseValidator {
  static FaqValidationError? validate(FaqResponse response) {
    if (response.data.isEmpty) {
      return FaqValidationError.emptyData;
    }

    for (final item in response.data) {
      if (item.question.trim().isEmpty) {
        return FaqValidationError.emptyQuestion;
      }

      if (item.answer.trim().isEmpty) {
        return FaqValidationError.emptyAnswer;
      }

      if (item.question.length > 200) {
        return FaqValidationError.questionTooLong;
      }

      if (item.answer.length > 2000) {
        return FaqValidationError.answerTooLong;
      }
    }

    return null; // VÃ¡lida
  }
}
```

#### **ValidaciÃ³n de Entidad**

```dart
class FaqEntityValidator {
  static bool isValidFaqItem(FaqItemEntity faq) {
    return faq.question.isNotEmpty &&
           faq.answer.isNotEmpty &&
           faq.question.length <= 200 &&
           faq.answer.length <= 2000;
  }

  static List<FaqItemEntity> filterValidFaqs(
    List<FaqItemEntity> faqs,
  ) {
    return faqs.where(isValidFaqItem).toList();
  }
}
```

### ğŸ›¡ï¸ Consideraciones de Seguridad

-   SanitizaciÃ³n de contenido para prevenir XSS
-   ValidaciÃ³n de longitud para evitar abusos
-   Filtrado de caracteres especiales
-   Rate limiting para prevenir abusos de API

---

## Testing

### ğŸ§ª Estrategia de Testing

#### **1. Unit Tests**

```dart
// test/unit/faq_test.dart
void main() {
  group('FaqRepository', () {
    test('debe obtener FAQs correctamente', () {
      // Test de carga exitosa
    });

    test('debe manejar error de autenticaciÃ³n', () {
      // Test de manejo de 401
    });

    test('debe manejar timeout de conexiÃ³n', () {
      // Test de manejo de timeout
    });
  });

  group('FaqItemEntity', () {
    test('debe crearse desde API response', () {
      // Test de conversiÃ³n desde DTO
    });

    test('debe validar igualdad correctamente', () {
      // Test de operator == y hashCode
    });
  });
}
```

#### **2. Widget Tests**

```dart
// test/widget/faq_screen_test.dart
void main() {
  testWidgets('debe mostrar lista de FAQs', (tester) async {
    // Test de renderizado de lista
  });

  testWidgets('debe mostrar error cuando falla la carga', (tester) async {
    // Test de pantalla de error
  });

  testWidgets('debe permitir pull-to-refresh', (tester) async {
    // Test de actualizaciÃ³n manual
  });
}
```

#### **3. Integration Tests**

```dart
// test/integration/faq_flow_test.dart
void main() {
  integrationTest('flujo completo de carga de FAQs', () async {
    // Simular: menÃº â†’ pantalla FAQ â†’ carga â†’ visualizaciÃ³n
  });

  integrationTest('manejo de errores de red', () async {
    // Test de recuperaciÃ³n ante fallos
  });
}
```

### ğŸ“‹ Casos de Prueba CrÃ­ticos

#### **Flujos de Usuario**

-   âœ… Usuario accede a FAQs y ve lista completa
-   âœ… Usuario expande pregunta y lee respuesta
-   âœ… Usuario actualiza contenido con pull-to-refresh
-   âœ… Usuario maneja error de conexiÃ³n y reintenta
-   âœ… Usuario ve mensaje cuando no hay FAQs disponibles

#### **Casos LÃ­mite**

-   ğŸ”„ Lista vacÃ­a de FAQs
-   ğŸ”„ Respuesta con formato invÃ¡lido
-   ğŸ”„ ConexiÃ³n lenta o intermitente
-   ğŸ”„ Muchas FAQs (performance)
-   ğŸ”„ Contenido muy largo en respuestas

### ğŸ“Š MÃ©tricas de Testing

-   **Cobertura mÃ­nima**: 80% para cÃ³digo de repository
-   **Tests de UI**: Interacciones crÃ­ticas del usuario
-   **Tests de error**: Todos los tipos de error cubiertos
-   **Tests de rendimiento**: Listas grandes y contenido largo

---

## Seguridad

### ğŸ”’ CaracterÃ­sticas de Seguridad

#### **1. ProtecciÃ³n de Acceso**

-   âœ… **AutenticaciÃ³n obligatoria**: Solo usuarios validados
-   âœ… **Token JWT requerido**: VerificaciÃ³n de identidad
-   âœ… **SesiÃ³n activa**: ConfirmaciÃ³n de usuario logueado

#### **2. Seguridad en Contenido**

-   âœ… **SanitizaciÃ³n de texto**: PrevenciÃ³n de XSS
-   âœ… **ValidaciÃ³n de longitud**: LÃ­mites de contenido
-   âœ… **Filtrado de caracteres**: Caracteres seguros permitidos

#### **3. Seguridad en TransacciÃ³n**

```dart
class FaqSecurityValidator {
  static bool canAccessFaqs(UserEntity user) {
    // Validar que el usuario estÃ¡ autenticado
    if (user.id == null) return false;

    // Validar que la sesiÃ³n estÃ¡ activa
    if (!_isSessionActive(user)) return false;

    return true;
  }

  static String sanitizeContent(String content) {
    // Remover caracteres peligrosos
    return content
        .replaceAll(RegExp(r'<[^>]*>'), '') // Remove HTML tags
        .replaceAll(RegExp(r'javascript:'), '') // Remove JS protocols
        .trim();
  }
}
```

### ğŸ›¡ï¸ Consideraciones de Privacidad

-   Las FAQs son informaciÃ³n pÃºblica para usuarios autenticados
-   No se almacenan datos personales en las respuestas
-   El acceso estÃ¡ limitado a usuarios registrados
-   AuditorÃ­a de accesos para mÃ©tricas de uso

### ğŸ” Best Practices Implementadas

```dart
// Ejemplo de implementaciÃ³n segura
class SecureFaqService {
  Future<List<FaqItemEntity>> getFaqsSecurely(
    UserContext user,
  ) async {
    try {
      // 1. Validar autenticaciÃ³n
      if (!_securityValidator.canAccessFaqs(user)) {
        throw UnauthorizedException('Usuario no autorizado');
      }

      // 2. Obtener datos de forma segura
      final response = await _repository.getFaqs();

      // 3. Validar y sanitizar contenido
      final validFaqs = _securityValidator.filterValidFaqs(
        FaqItemEntity.fromApiResponseList(response.data),
      );

      // 4. Registrar acceso para auditorÃ­a
      _auditLogger.logFaqAccess(user.id, validFaqs.length);

      return validFaqs;
    } catch (e) {
      _auditLogger.logFaqError(user.id, e);
      throw SecureFaqException.fromError(e);
    }
  }
}
```

---

## ğŸš€ ImplementaciÃ³n y Mantenimiento

### ğŸ“¦ Dependencias Clave

```yaml
dependencies:
    flutter_riverpod: ^2.4.0 # GestiÃ³n de estado
    dio: ^5.3.0 # Cliente HTTP

dev_dependencies:
    riverpod_generator: ^2.3.0 # Code generation
    build_runner: ^2.4.0 # Herramienta de generaciÃ³n
```

### ğŸ”§ Comandos de Desarrollo

```bash
# Generar cÃ³digo (requerido despuÃ©s de cambios)
dart run build_runner build --delete-conflicting-outputs

# Modo watch durante desarrollo
dart run build_runner watch -d

# Ejecutar pruebas
flutter test test/features/faq/

# AnÃ¡lisis estÃ¡tico
flutter analyze lib/features/faq/
```

### ğŸ“ Mejores PrÃ¡cticas

1. **Code Generation**: Siempre ejecutar `build_runner` despuÃ©s de modificar providers
2. **State Management**: Usar FutureProvider para datos asÃ­ncronos simples
3. **Error Handling**: Manejo especÃ­fico para cada tipo de error
4. **Testing**: Mantener cobertura >80% para cÃ³digo crÃ­tico
5. **Performance**: Optimizar listas grandes con ListView.builder
6. **UX**: Proporcionar feedback claro en todos los estados

---

## ğŸ”— Integraciones

### ğŸ“„ MÃ³dulos que utilizan FAQ

#### **AppSidebarLayout**

-   Acceso desde menÃº lateral de navegaciÃ³n
-   IntegraciÃ³n con navegaciÃ³n principal

#### **Router**

-   Ruta `/faq` registrada en sistema de navegaciÃ³n
-   Transiciones personalizadas para mejor UX

#### **HttpClient**

-   ComparticiÃ³n de configuraciÃ³n de red
-   Interceptores de autenticaciÃ³n y errores

### ğŸ”„ Flujo de Datos

```
AppSidebarLayout
  â†“
FaqScreen
  â†“
faqsProvider (FutureProvider)
  â†“
FaqRepository
  â†“
HttpClient
  â†“
API Backend (/client/help)
  â†“
FaqResponse
  â†“
FaqItemEntity[]
  â†“
UI Renderizada
```
